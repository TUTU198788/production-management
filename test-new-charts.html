<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°å›¾è¡¨åŠŸèƒ½æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            color: #1f2937;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        h1 {
            color: #059669;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-info {
            background: #eff6ff;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .test-info h3 {
            color: #3b82f6;
            margin: 0 0 15px 0;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin: 30px 0;
        }
        
        .chart-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        
        .chart-header {
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }
        
        .chart-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }
        
        .chart-content {
            padding: 20px;
            height: 300px;
            position: relative;
        }
        
        .chart-content canvas {
            width: 100% !important;
            height: 100% !important;
        }
        
        .big-button {
            background: #059669;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            width: calc(33.33% - 20px);
            box-sizing: border-box;
        }
        
        .big-button:hover {
            background: #047857;
        }
        
        .big-button.secondary {
            background: #3b82f6;
        }
        
        .big-button.secondary:hover {
            background: #2563eb;
        }
        
        .big-button.warning {
            background: #f59e0b;
        }
        
        .big-button.warning:hover {
            background: #d97706;
        }
        
        .result {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .success {
            background: #ecfdf5;
            border: 2px solid #059669;
            color: #059669;
        }
        
        .info {
            background: #eff6ff;
            border: 2px solid #3b82f6;
            color: #3b82f6;
        }
        
        .warning {
            background: #fffbeb;
            border: 2px solid #f59e0b;
            color: #f59e0b;
        }
        
        .error {
            background: #fef2f2;
            border: 2px solid #dc2626;
            color: #dc2626;
        }
        
        .data-summary {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .data-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 8px;
            background: white;
            border-radius: 4px;
        }
        
        .data-label {
            font-weight: 500;
            color: #374151;
        }
        
        .data-value {
            color: #059669;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š æ–°å›¾è¡¨åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-info">
            <h3>ğŸ¯ å›¾è¡¨æ”¹è¿›è¯´æ˜</h3>
            <ul>
                <li><strong>åŸæ¥</strong>ï¼šä¸€ä¸ªä¸‰çŠ¶æ€å›¾è¡¨ï¼ˆå·²å®Œæˆã€è¿›è¡Œä¸­ã€å¾…å¼€å§‹ï¼‰</li>
                <li><strong>ç°åœ¨</strong>ï¼šä¸¤ä¸ªç‹¬ç«‹å›¾è¡¨</li>
                <li><strong>å›¾è¡¨1</strong>ï¼šç”Ÿäº§çŠ¶æ€åˆ†å¸ƒï¼ˆæœªç”Ÿäº§ vs å·²ç”Ÿäº§ï¼‰</li>
                <li><strong>å›¾è¡¨2</strong>ï¼šå‘è´§çŠ¶æ€åˆ†å¸ƒï¼ˆåº“å­˜ vs å·²å‘è´§ï¼‰</li>
                <li><strong>æ•°æ®æº</strong>ï¼šåŸºäºå®é™…ç”Ÿäº§æ•°æ®åŠ¨æ€è®¡ç®—</li>
            </ul>
        </div>
        
        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <button class="big-button" onclick="loadTestData()">
                ğŸ“Š åŠ è½½æµ‹è¯•æ•°æ®
            </button>
            
            <button class="big-button secondary" onclick="updateCharts()">
                ğŸ”„ æ›´æ–°å›¾è¡¨
            </button>
            
            <button class="big-button warning" onclick="openMainPage()">
                ğŸ  æ‰“å¼€ä¸»é¡µé¢
            </button>
        </div>
        
        <!-- å›¾è¡¨å±•ç¤ºåŒºåŸŸ -->
        <div class="charts-container">
            <!-- ç”Ÿäº§çŠ¶æ€åˆ†å¸ƒ -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3>ç”Ÿäº§çŠ¶æ€åˆ†å¸ƒ</h3>
                </div>
                <div class="chart-content">
                    <canvas id="productionChart"></canvas>
                </div>
            </div>

            <!-- å‘è´§çŠ¶æ€åˆ†å¸ƒ -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3>å‘è´§çŠ¶æ€åˆ†å¸ƒ</h3>
                </div>
                <div class="chart-content">
                    <canvas id="shippingChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="data-summary" id="dataSummary" style="display: none;">
            <h4>ğŸ“‹ æ•°æ®ç»Ÿè®¡</h4>
            <div id="dataItems">
                <!-- æ•°æ®é¡¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        let charts = {};
        
        // å›¾è¡¨é¢œè‰²é…ç½®
        const chartColors = {
            primary: '#3b82f6',
            success: '#10b981',
            warning: '#f59e0b',
            danger: '#ef4444',
            lightGray: '#e5e7eb'
        };
        
        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const result = document.createElement('div');
            result.className = 'result ' + type;
            result.innerHTML = message;
            resultsDiv.appendChild(result);
        }
        
        function initCharts() {
            // ç”Ÿäº§çŠ¶æ€åˆ†å¸ƒå›¾è¡¨
            const productionCtx = document.getElementById('productionChart');
            if (productionCtx) {
                charts.productionChart = new Chart(productionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['æœªç”Ÿäº§', 'å·²ç”Ÿäº§'],
                        datasets: [{
                            data: [50, 50],
                            backgroundColor: [
                                chartColors.lightGray,
                                chartColors.success
                            ],
                            borderWidth: 0,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '60%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(31, 41, 55, 0.9)',
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.parsed.toFixed(1)}%`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // å‘è´§çŠ¶æ€åˆ†å¸ƒå›¾è¡¨
            const shippingCtx = document.getElementById('shippingChart');
            if (shippingCtx) {
                charts.shippingChart = new Chart(shippingCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['åº“å­˜', 'å·²å‘è´§'],
                        datasets: [{
                            data: [50, 50],
                            backgroundColor: [
                                chartColors.warning,
                                chartColors.primary
                            ],
                            borderWidth: 0,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '60%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(31, 41, 55, 0.9)',
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.parsed.toFixed(1)}%`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        function loadTestData() {
            addResult('ğŸ” åŠ è½½ç”Ÿäº§æ•°æ®...', 'info');
            
            const productionData = localStorage.getItem('productionData');
            if (!productionData) {
                addResult('âŒ æ²¡æœ‰æ‰¾åˆ°ç”Ÿäº§æ•°æ®ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®', 'warning');
                updateChartsWithMockData();
                return;
            }
            
            try {
                const data = JSON.parse(productionData);
                updateChartsWithRealData(data);
                addResult(`âœ… æˆåŠŸåŠ è½½ ${data.length} æ¡ç”Ÿäº§è®°å½•`, 'success');
            } catch (error) {
                addResult(`âŒ æ•°æ®åŠ è½½å¤±è´¥ï¼š${error.message}`, 'error');
                updateChartsWithMockData();
            }
        }
        
        function updateChartsWithRealData(data) {
            // è®¡ç®—ç”Ÿäº§çŠ¶æ€
            let totalPlanned = 0;
            let totalProduced = 0;
            let totalShipped = 0;
            
            data.forEach(item => {
                totalPlanned += item.planned || 0;
                totalProduced += item.produced || 0;
                totalShipped += item.shipped || 0;
            });
            
            // æ›´æ–°ç”Ÿäº§çŠ¶æ€å›¾è¡¨
            const unproduced = totalPlanned - totalProduced;
            const unproducedPercentage = totalPlanned > 0 ? ((unproduced / totalPlanned) * 100) : 100;
            const producedPercentage = totalPlanned > 0 ? ((totalProduced / totalPlanned) * 100) : 0;
            
            if (charts.productionChart) {
                charts.productionChart.data.datasets[0].data = [
                    parseFloat(unproducedPercentage.toFixed(1)),
                    parseFloat(producedPercentage.toFixed(1))
                ];
                charts.productionChart.update();
            }
            
            // æ›´æ–°å‘è´§çŠ¶æ€å›¾è¡¨
            const inventory = totalProduced - totalShipped;
            const inventoryPercentage = totalProduced > 0 ? ((inventory / totalProduced) * 100) : 100;
            const shippedPercentage = totalProduced > 0 ? ((totalShipped / totalProduced) * 100) : 0;
            
            if (charts.shippingChart) {
                charts.shippingChart.data.datasets[0].data = [
                    parseFloat(inventoryPercentage.toFixed(1)),
                    parseFloat(shippedPercentage.toFixed(1))
                ];
                charts.shippingChart.update();
            }
            
            // æ˜¾ç¤ºæ•°æ®ç»Ÿè®¡
            showDataSummary(totalPlanned, totalProduced, totalShipped);
        }
        
        function updateChartsWithMockData() {
            // æ¨¡æ‹Ÿæ•°æ®
            const mockData = {
                totalPlanned: 1000,
                totalProduced: 650,
                totalShipped: 400
            };
            
            // æ›´æ–°ç”Ÿäº§çŠ¶æ€å›¾è¡¨
            const unproducedPercentage = ((mockData.totalPlanned - mockData.totalProduced) / mockData.totalPlanned) * 100;
            const producedPercentage = (mockData.totalProduced / mockData.totalPlanned) * 100;
            
            if (charts.productionChart) {
                charts.productionChart.data.datasets[0].data = [
                    parseFloat(unproducedPercentage.toFixed(1)),
                    parseFloat(producedPercentage.toFixed(1))
                ];
                charts.productionChart.update();
            }
            
            // æ›´æ–°å‘è´§çŠ¶æ€å›¾è¡¨
            const inventoryPercentage = ((mockData.totalProduced - mockData.totalShipped) / mockData.totalProduced) * 100;
            const shippedPercentage = (mockData.totalShipped / mockData.totalProduced) * 100;
            
            if (charts.shippingChart) {
                charts.shippingChart.data.datasets[0].data = [
                    parseFloat(inventoryPercentage.toFixed(1)),
                    parseFloat(shippedPercentage.toFixed(1))
                ];
                charts.shippingChart.update();
            }
            
            showDataSummary(mockData.totalPlanned, mockData.totalProduced, mockData.totalShipped);
        }
        
        function showDataSummary(planned, produced, shipped) {
            const dataSummary = document.getElementById('dataSummary');
            const dataItems = document.getElementById('dataItems');
            
            const inventory = produced - shipped;
            
            dataItems.innerHTML = `
                <div class="data-item">
                    <span class="data-label">è®¡åˆ’æ€»é‡</span>
                    <span class="data-value">${planned.toLocaleString()} æ ¹</span>
                </div>
                <div class="data-item">
                    <span class="data-label">å·²ç”Ÿäº§</span>
                    <span class="data-value">${produced.toLocaleString()} æ ¹</span>
                </div>
                <div class="data-item">
                    <span class="data-label">æœªç”Ÿäº§</span>
                    <span class="data-value">${(planned - produced).toLocaleString()} æ ¹</span>
                </div>
                <div class="data-item">
                    <span class="data-label">å·²å‘è´§</span>
                    <span class="data-value">${shipped.toLocaleString()} æ ¹</span>
                </div>
                <div class="data-item">
                    <span class="data-label">åº“å­˜</span>
                    <span class="data-value">${inventory.toLocaleString()} æ ¹</span>
                </div>
            `;
            
            dataSummary.style.display = 'block';
        }
        
        function updateCharts() {
            addResult('ğŸ”„ æ›´æ–°å›¾è¡¨...', 'info');
            loadTestData();
        }
        
        function openMainPage() {
            window.open('index.html', '_blank');
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            initCharts();
            setTimeout(loadTestData, 500);
        };
    </script>
</body>
</html>
