<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excelå¯¼å…¥æ–°å¢åŒºåŸŸåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            color: #1f2937;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        h1 {
            color: #059669;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-info {
            background: #eff6ff;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .test-info h3 {
            color: #3b82f6;
            margin: 0 0 15px 0;
        }
        
        .test-info ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .test-info li {
            margin: 8px 0;
        }
        
        .big-button {
            background: #059669;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            width: calc(50% - 20px);
            box-sizing: border-box;
        }
        
        .big-button:hover {
            background: #047857;
        }
        
        .big-button.secondary {
            background: #3b82f6;
        }
        
        .big-button.secondary:hover {
            background: #2563eb;
        }
        
        .demo-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px dashed #e5e7eb;
            border-radius: 12px;
            background: #f9fafb;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }
        
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }
        
        .form-group select option[value="__add_new__"] {
            color: #059669;
            font-weight: bold;
        }
        
        .result {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .success {
            background: #ecfdf5;
            border: 2px solid #059669;
            color: #059669;
        }
        
        .info {
            background: #eff6ff;
            border: 2px solid #3b82f6;
            color: #3b82f6;
        }
        
        .warning {
            background: #fffbeb;
            border: 2px solid #f59e0b;
            color: #f59e0b;
        }
        
        .error {
            background: #fef2f2;
            border: 2px solid #dc2626;
            color: #dc2626;
        }
        
        .area-list {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .area-item {
            display: inline-block;
            background: #3b82f6;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            margin: 2px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Excelå¯¼å…¥æ–°å¢åŒºåŸŸåŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-info">
            <h3>ğŸ§ª æµ‹è¯•è¯´æ˜</h3>
            <ul>
                <li><strong>æ–°å¢åŒºåŸŸåŠŸèƒ½</strong>ï¼šåœ¨Excelå¯¼å…¥ç•Œé¢çš„åŒºåŸŸä¸‹æ‹‰æ¡†ä¸­é€‰æ‹©"+ æ–°å¢åŒºåŸŸ"</li>
                <li><strong>åŒºåŸŸåç§°æ ¼å¼</strong>ï¼šå»ºè®®ä½¿ç”¨C1ã€C2ã€E1ã€D6ç­‰æ ¼å¼</li>
                <li><strong>é‡å¤æ£€æŸ¥</strong>ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æŸ¥åŒºåŸŸæ˜¯å¦å·²å­˜åœ¨</li>
                <li><strong>è‡ªåŠ¨é€‰æ‹©</strong>ï¼šæ–°å¢æˆåŠŸåä¼šè‡ªåŠ¨é€‰æ‹©æ–°åŒºåŸŸ</li>
                <li><strong>æŒä¹…ä¿å­˜</strong>ï¼šæ–°å¢çš„åŒºåŸŸä¼šä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨</li>
            </ul>
        </div>
        
        <div style="display: flex; gap: 20px;">
            <button class="big-button" onclick="openExcelImportTest()">
                ğŸ“¥ æµ‹è¯•Excelå¯¼å…¥ç•Œé¢
            </button>
            
            <button class="big-button secondary" onclick="openMainPage()">
                ğŸ  æ‰“å¼€ä¸»é¡µé¢
            </button>
        </div>
        
        <div class="demo-section">
            <h3>ğŸ¯ æ¨¡æ‹ŸExcelå¯¼å…¥åŒºåŸŸé€‰æ‹©</h3>
            <p>è¿™é‡Œæ¨¡æ‹ŸExcelå¯¼å…¥ç•Œé¢çš„åŒºåŸŸé€‰æ‹©åŠŸèƒ½ï¼š</p>
            
            <div class="form-group">
                <label for="testAreaSelect">å·¥åœ°åŒºåŸŸ *</label>
                <select id="testAreaSelect" required>
                    <option value="">è¯·é€‰æ‹©å·¥åœ°åŒºåŸŸ</option>
                    <!-- åŒºåŸŸé€‰é¡¹å°†åŠ¨æ€åŠ è½½ -->
                </select>
            </div>
            
            <div class="area-list">
                <strong>å½“å‰å·²æœ‰åŒºåŸŸï¼š</strong>
                <div id="currentAreas">
                    <!-- å½“å‰åŒºåŸŸåˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        let customAreas = new Set();
        
        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const result = document.createElement('div');
            result.className = 'result ' + type;
            result.innerHTML = message;
            resultsDiv.appendChild(result);
        }
        
        function loadCustomAreas() {
            try {
                const savedAreas = localStorage.getItem('customAreas');
                if (savedAreas) {
                    customAreas = new Set(JSON.parse(savedAreas));
                } else {
                    // é»˜è®¤åŒºåŸŸ
                    customAreas = new Set(['C1', 'C2', 'C3', 'E1', 'E3', 'D6', 'A14']);
                }
            } catch (error) {
                console.error('åŠ è½½è‡ªå®šä¹‰åŒºåŸŸå¤±è´¥:', error);
                customAreas = new Set(['C1', 'C2', 'C3', 'E1', 'E3', 'D6', 'A14']);
            }
        }
        
        function updateAreaSelect() {
            const select = document.getElementById('testAreaSelect');
            const currentValue = select.value;
            
            // æ¸…ç©ºç°æœ‰é€‰é¡¹
            select.innerHTML = '<option value="">è¯·é€‰æ‹©å·¥åœ°åŒºåŸŸ</option>';
            
            // æ·»åŠ æ‰€æœ‰åŒºåŸŸé€‰é¡¹ï¼ˆæŒ‰å­—æ¯æ•°å­—æ’åºï¼‰
            const sortedAreas = [...customAreas].sort();
            sortedAreas.forEach(area => {
                const option = document.createElement('option');
                option.value = area;
                option.textContent = `${area}åŒºåŸŸ`;
                select.appendChild(option);
            });
            
            // æ·»åŠ æ–°å¢åŒºåŸŸé€‰é¡¹
            const addOption = document.createElement('option');
            addOption.value = '__add_new__';
            addOption.textContent = '+ æ–°å¢åŒºåŸŸ';
            addOption.style.color = '#059669';
            addOption.style.fontWeight = 'bold';
            select.appendChild(addOption);
            
            // æ¢å¤ä¹‹å‰çš„é€‰æ‹©
            if (currentValue && currentValue !== '__add_new__') {
                select.value = currentValue;
            }
        }
        
        function updateCurrentAreasList() {
            const container = document.getElementById('currentAreas');
            container.innerHTML = '';
            
            if (customAreas.size === 0) {
                container.innerHTML = '<span style="color: #6b7280;">æš‚æ— åŒºåŸŸ</span>';
                return;
            }
            
            const sortedAreas = [...customAreas].sort();
            sortedAreas.forEach(area => {
                const item = document.createElement('span');
                item.className = 'area-item';
                item.textContent = area + 'åŒºåŸŸ';
                container.appendChild(item);
            });
        }
        
        function handleNewArea() {
            const areaName = prompt('è¯·è¾“å…¥æ–°åŒºåŸŸåç§°ï¼ˆå¦‚ï¼šC4ã€E2ç­‰ï¼‰ï¼š');
            
            if (!areaName) {
                // ç”¨æˆ·å–æ¶ˆï¼Œé‡ç½®é€‰æ‹©
                document.getElementById('testAreaSelect').value = '';
                return;
            }

            // éªŒè¯åŒºåŸŸåç§°æ ¼å¼
            const trimmedName = areaName.trim().toUpperCase();
            if (!trimmedName) {
                addResult('âŒ åŒºåŸŸåç§°ä¸èƒ½ä¸ºç©º', 'error');
                document.getElementById('testAreaSelect').value = '';
                return;
            }

            // æ£€æŸ¥åŒºåŸŸæ˜¯å¦å·²å­˜åœ¨
            if (customAreas.has(trimmedName)) {
                addResult(`âš ï¸ åŒºåŸŸ ${trimmedName} å·²å­˜åœ¨`, 'warning');
                // ç›´æ¥é€‰æ‹©å·²å­˜åœ¨çš„åŒºåŸŸ
                document.getElementById('testAreaSelect').value = trimmedName;
                return;
            }

            // æ·»åŠ æ–°åŒºåŸŸ
            customAreas.add(trimmedName);
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('customAreas', JSON.stringify([...customAreas]));

            // æ›´æ–°ç•Œé¢
            updateAreaSelect();
            updateCurrentAreasList();

            // é€‰æ‹©æ–°æ·»åŠ çš„åŒºåŸŸ
            document.getElementById('testAreaSelect').value = trimmedName;

            // æ˜¾ç¤ºæˆåŠŸæç¤º
            addResult(`âœ… åŒºåŸŸ ${trimmedName} æ·»åŠ æˆåŠŸï¼`, 'success');

            console.log('æ–°å¢åŒºåŸŸ:', trimmedName, 'å½“å‰æ‰€æœ‰åŒºåŸŸ:', [...customAreas]);
        }
        
        function openExcelImportTest() {
            addResult('ğŸ” è¯·åœ¨ä¸Šæ–¹çš„åŒºåŸŸé€‰æ‹©ä¸‹æ‹‰æ¡†ä¸­æµ‹è¯•æ–°å¢åŒºåŸŸåŠŸèƒ½', 'info');
            addResult('ğŸ’¡ é€‰æ‹©"+ æ–°å¢åŒºåŸŸ"é€‰é¡¹æ¥æ·»åŠ æ–°çš„å·¥åœ°åŒºåŸŸ', 'info');
        }
        
        function openMainPage() {
            window.open('index.html', '_blank');
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            loadCustomAreas();
            updateAreaSelect();
            updateCurrentAreasList();
            
            // ç»‘å®šåŒºåŸŸé€‰æ‹©äº‹ä»¶
            document.getElementById('testAreaSelect').addEventListener('change', function() {
                if (this.value === '__add_new__') {
                    handleNewArea();
                } else if (this.value) {
                    addResult(`âœ… å·²é€‰æ‹©åŒºåŸŸï¼š${this.value}`, 'success');
                }
            });
            
            addResult('ğŸš€ æµ‹è¯•ç¯å¢ƒå·²å‡†å¤‡å°±ç»ªï¼', 'info');
        };
    </script>
</body>
</html>
