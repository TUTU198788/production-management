<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿäº§ç»Ÿè®¡è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
        }
        .result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        .info { border-left: 4px solid #17a2b8; }
        .warning { border-left: 4px solid #ffc107; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ç”Ÿäº§ç»Ÿè®¡è°ƒè¯•å·¥å…·</h1>
        
        <div class="section">
            <h3>ğŸ“Š æ•°æ®æ£€æŸ¥</h3>
            <button onclick="checkData()">æ£€æŸ¥æœ¬åœ°æ•°æ®</button>
            <button onclick="checkProductionRecords()">æ£€æŸ¥ç”Ÿäº§è®°å½•</button>
            <button onclick="testStatistics()">æµ‹è¯•ç»Ÿè®¡è®¡ç®—</button>
            <div id="dataResults"></div>
        </div>

        <div class="section">
            <h3>ğŸ”§ åŠŸèƒ½æµ‹è¯•</h3>
            <button onclick="testDataManager()">æµ‹è¯•æ•°æ®ç®¡ç†å™¨</button>
            <button onclick="testExtractFunction()">æµ‹è¯•æå–å‡½æ•°</button>
            <button onclick="simulateProductionManagement()">æ¨¡æ‹Ÿç”Ÿäº§ç®¡ç†</button>
            <div id="functionResults"></div>
        </div>

        <div class="section">
            <h3>ğŸ“‹ è¯¦ç»†ä¿¡æ¯</h3>
            <div id="detailResults"></div>
        </div>
    </div>

    <script>
        function addResult(message, type = 'info', containerId = 'dataResults') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            container.appendChild(div);
        }

        function checkData() {
            const container = document.getElementById('dataResults');
            container.innerHTML = '';
            
            addResult('ğŸ” æ£€æŸ¥æœ¬åœ°å­˜å‚¨æ•°æ®...', 'info');
            
            const productionData = localStorage.getItem('productionData');
            if (!productionData) {
                addResult('âŒ æ²¡æœ‰æ‰¾åˆ°ç”Ÿäº§æ•°æ®', 'error');
                return;
            }
            
            try {
                const data = JSON.parse(productionData);
                addResult(`âœ… æ‰¾åˆ°ç”Ÿäº§æ•°æ®ï¼Œå…± ${data.length} æ¡è®°å½•`, 'success');
                
                // æ£€æŸ¥æœ‰ç”Ÿäº§æ•°é‡çš„è®°å½•
                const producedItems = data.filter(item => item.produced > 0);
                addResult(`ğŸ“¦ æœ‰ç”Ÿäº§æ•°é‡çš„è®°å½•: ${producedItems.length} æ¡`, 'info');
                
                if (producedItems.length > 0) {
                    addResult('ğŸ“ ç”Ÿäº§è®°å½•æ ·æœ¬:', 'info');
                    producedItems.slice(0, 3).forEach((item, index) => {
                        addResult(`  ${index + 1}. ${item.spec} (${item.area}) - å·²ç”Ÿäº§: ${item.produced}æ ¹`, 'info');
                    });
                }
                
                // è®¡ç®—æ€»ç”Ÿäº§é‡
                const totalProduced = data.reduce((sum, item) => sum + (item.produced || 0), 0);
                addResult(`ğŸ“Š æ€»ç”Ÿäº§é‡: ${totalProduced} æ ¹`, 'success');
                
            } catch (error) {
                addResult(`âŒ æ•°æ®è§£æå¤±è´¥: ${error.message}`, 'error');
            }
        }

        function checkProductionRecords() {
            const container = document.getElementById('dataResults');
            container.innerHTML = '';
            
            addResult('ğŸ” æ£€æŸ¥è¯¦ç»†ç”Ÿäº§è®°å½•...', 'info');
            
            const productionData = localStorage.getItem('productionData');
            if (!productionData) {
                addResult('âŒ æ²¡æœ‰æ‰¾åˆ°ç”Ÿäº§æ•°æ®', 'error');
                return;
            }
            
            try {
                const data = JSON.parse(productionData);
                let totalDetailedRecords = 0;
                let itemsWithDetailedRecords = 0;
                
                data.forEach(item => {
                    if (item.productionRecords && Array.isArray(item.productionRecords)) {
                        itemsWithDetailedRecords++;
                        totalDetailedRecords += item.productionRecords.length;
                    }
                });
                
                addResult(`ğŸ“‹ æœ‰è¯¦ç»†è®°å½•çš„é¡¹ç›®: ${itemsWithDetailedRecords} ä¸ª`, 'info');
                addResult(`ğŸ“Š è¯¦ç»†è®°å½•æ€»æ•°: ${totalDetailedRecords} æ¡`, 'info');
                
                // æ˜¾ç¤ºè¯¦ç»†è®°å½•æ ·æœ¬
                if (itemsWithDetailedRecords > 0) {
                    const itemWithRecords = data.find(item => item.productionRecords && Array.isArray(item.productionRecords));
                    addResult('ğŸ“ è¯¦ç»†è®°å½•æ ·æœ¬:', 'info');
                    addResult(`  è§„æ ¼: ${itemWithRecords.spec}`, 'info');
                    addResult(`  è®°å½•æ•°: ${itemWithRecords.productionRecords.length}`, 'info');
                    itemWithRecords.productionRecords.slice(0, 2).forEach((record, index) => {
                        addResult(`    ${index + 1}. æ•°é‡: ${record.quantity}, æ—¥æœŸ: ${record.date}`, 'info');
                    });
                }
                
            } catch (error) {
                addResult(`âŒ æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testStatistics() {
            const container = document.getElementById('functionResults');
            container.innerHTML = '';
            
            addResult('ğŸ§® æµ‹è¯•ç»Ÿè®¡è®¡ç®—...', 'info', 'functionResults');
            
            const productionData = localStorage.getItem('productionData');
            if (!productionData) {
                addResult('âŒ æ²¡æœ‰æ‰¾åˆ°ç”Ÿäº§æ•°æ®', 'error', 'functionResults');
                return;
            }
            
            try {
                const data = JSON.parse(productionData);
                
                // æ¨¡æ‹Ÿ extractProductionRecords å‡½æ•°
                const records = [];
                let recordId = 1;
                
                data.forEach(item => {
                    if (item.produced > 0) {
                        if (item.productionRecords && Array.isArray(item.productionRecords)) {
                            item.productionRecords.forEach(record => {
                                records.push({
                                    id: `${item.id}_${recordId++}`,
                                    spec: item.spec,
                                    area: item.area,
                                    quantity: record.quantity || 0
                                });
                            });
                        } else {
                            records.push({
                                id: `${item.id}_${recordId++}`,
                                spec: item.spec,
                                area: item.area,
                                quantity: item.produced
                            });
                        }
                    }
                });
                
                // è®¡ç®—ç»Ÿè®¡
                const totalRecords = records.length;
                const totalQuantity = records.reduce((sum, record) => sum + record.quantity, 0);
                const uniqueSpecs = new Set(records.map(record => record.spec));
                
                addResult(`âœ… æå–è®°å½•æ•°: ${totalRecords}`, 'success', 'functionResults');
                addResult(`âœ… æ€»ç”Ÿäº§é‡: ${totalQuantity} æ ¹`, 'success', 'functionResults');
                addResult(`âœ… è§„æ ¼ç§ç±»: ${uniqueSpecs.size} ç§`, 'success', 'functionResults');
                
                // æŒ‰å‹å·ç»Ÿè®¡
                const typeStats = {};
                records.forEach(record => {
                    const typeMatch = record.spec.match(/^(H\d+)/);
                    const type = typeMatch ? typeMatch[1] : 'å…¶ä»–';
                    
                    if (!typeStats[type]) {
                        typeStats[type] = new Set();
                    }
                    typeStats[type].add(record.spec);
                });
                
                const typeStatsText = Object.keys(typeStats)
                    .sort()
                    .map(type => `${type}: ${typeStats[type].size}ç§`)
                    .join(', ');
                
                addResult(`âœ… å‹å·ç»Ÿè®¡: ${typeStatsText}`, 'success', 'functionResults');
                
            } catch (error) {
                addResult(`âŒ ç»Ÿè®¡è®¡ç®—å¤±è´¥: ${error.message}`, 'error', 'functionResults');
            }
        }

        function testDataManager() {
            const container = document.getElementById('functionResults');
            container.innerHTML = '';
            
            addResult('ğŸ”§ æµ‹è¯•æ•°æ®ç®¡ç†å™¨...', 'info', 'functionResults');
            
            if (typeof window.dataManager === 'undefined') {
                addResult('âŒ dataManager æœªå®šä¹‰', 'error', 'functionResults');
                return;
            }
            
            addResult('âœ… dataManager å­˜åœ¨', 'success', 'functionResults');
            
            // æ£€æŸ¥å…³é”®æ–¹æ³•
            const methods = ['extractProductionRecords', 'updateProductionStats', 'initProductionManagement'];
            methods.forEach(method => {
                if (typeof window.dataManager[method] === 'function') {
                    addResult(`âœ… ${method} æ–¹æ³•å­˜åœ¨`, 'success', 'functionResults');
                } else {
                    addResult(`âŒ ${method} æ–¹æ³•ä¸å­˜åœ¨`, 'error', 'functionResults');
                }
            });
            
            // æ£€æŸ¥æ•°æ®
            if (window.dataManager.data && Array.isArray(window.dataManager.data)) {
                addResult(`âœ… æ•°æ®æ•°ç»„å­˜åœ¨ï¼Œé•¿åº¦: ${window.dataManager.data.length}`, 'success', 'functionResults');
            } else {
                addResult('âŒ æ•°æ®æ•°ç»„ä¸å­˜åœ¨æˆ–æ— æ•ˆ', 'error', 'functionResults');
            }
        }

        function testExtractFunction() {
            const container = document.getElementById('functionResults');
            container.innerHTML = '';
            
            addResult('ğŸ” æµ‹è¯•æå–å‡½æ•°...', 'info', 'functionResults');
            
            if (typeof window.dataManager === 'undefined') {
                addResult('âŒ dataManager æœªå®šä¹‰', 'error', 'functionResults');
                return;
            }
            
            try {
                const records = window.dataManager.extractProductionRecords();
                addResult(`âœ… æå–æˆåŠŸï¼Œè®°å½•æ•°: ${records.length}`, 'success', 'functionResults');
                
                if (records.length > 0) {
                    addResult('ğŸ“ è®°å½•æ ·æœ¬:', 'info', 'functionResults');
                    records.slice(0, 3).forEach((record, index) => {
                        addResult(`  ${index + 1}. ${record.spec} (${record.area}) - ${record.quantity}æ ¹`, 'info', 'functionResults');
                    });
                }
            } catch (error) {
                addResult(`âŒ æå–å¤±è´¥: ${error.message}`, 'error', 'functionResults');
            }
        }

        function simulateProductionManagement() {
            const container = document.getElementById('detailResults');
            container.innerHTML = '';
            
            addResult('ğŸ­ æ¨¡æ‹Ÿç”Ÿäº§ç®¡ç†åˆå§‹åŒ–...', 'info', 'detailResults');
            
            if (typeof window.dataManager === 'undefined') {
                addResult('âŒ dataManager æœªå®šä¹‰', 'error', 'detailResults');
                return;
            }
            
            try {
                // æ¨¡æ‹Ÿåˆå§‹åŒ–è¿‡ç¨‹
                window.dataManager.initProductionManagement();
                addResult('âœ… åˆå§‹åŒ–å®Œæˆ', 'success', 'detailResults');
                
                // æ£€æŸ¥é¡µé¢å…ƒç´ 
                const elements = {
                    totalProductionRecords: document.getElementById('totalProductionRecords'),
                    totalProducedQuantity: document.getElementById('totalProducedQuantity'),
                    totalProductionSpecs: document.getElementById('totalProductionSpecs'),
                    totalProductionAreas: document.getElementById('totalProductionAreas')
                };
                
                addResult('ğŸ¯ é¡µé¢å…ƒç´ æ£€æŸ¥:', 'info', 'detailResults');
                Object.keys(elements).forEach(key => {
                    if (elements[key]) {
                        addResult(`  âœ… ${key}: ${elements[key].textContent}`, 'success', 'detailResults');
                    } else {
                        addResult(`  âŒ ${key}: å…ƒç´ ä¸å­˜åœ¨`, 'error', 'detailResults');
                    }
                });
                
            } catch (error) {
                addResult(`âŒ æ¨¡æ‹Ÿå¤±è´¥: ${error.message}`, 'error', 'detailResults');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkData();
            }, 1000);
        });
    </script>
</body>
</html>
