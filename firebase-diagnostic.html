<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebaseè¿æ¥è¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1f2937;
            text-align: center;
            margin-bottom: 30px;
        }
        .diagnostic-section {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .diagnostic-section h3 {
            color: #3b82f6;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        .status-success { background: #10b981; }
        .status-warning { background: #f59e0b; }
        .status-error { background: #ef4444; }
        .status-unknown { background: #6b7280; }
        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        .btn:hover {
            background: #2563eb;
        }
        .btn-success {
            background: #10b981;
        }
        .btn-success:hover {
            background: #059669;
        }
        .result {
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 13px;
        }
        .result.success {
            background: #d1fae5;
            border: 1px solid #10b981;
            color: #065f46;
        }
        .result.error {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
        }
        .result.warning {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            color: #92400e;
        }
        .result.info {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            color: #1e40af;
        }
        .config-display {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 15px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: #3b82f6;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Firebaseè¿æ¥è¯Šæ–­å·¥å…·</h1>
        
        <div class="diagnostic-section">
            <h3>
                <span class="status-indicator status-unknown" id="overallStatus"></span>
                æ€»ä½“çŠ¶æ€
            </h3>
            <p>æ­£åœ¨æ£€æŸ¥Firebaseè¿æ¥çŠ¶æ€...</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <button class="btn" onclick="runFullDiagnostic()">å¼€å§‹å®Œæ•´è¯Šæ–­</button>
            <button class="btn btn-success" onclick="runQuickTest()">å¿«é€Ÿæµ‹è¯•</button>
        </div>

        <div class="diagnostic-section">
            <h3>
                <span class="status-indicator status-unknown" id="configStatus"></span>
                é…ç½®æ£€æŸ¥
            </h3>
            <div class="config-display" id="configDisplay">ç­‰å¾…æ£€æŸ¥...</div>
            <button class="btn" onclick="checkConfig()">æ£€æŸ¥é…ç½®</button>
        </div>

        <div class="diagnostic-section">
            <h3>
                <span class="status-indicator status-unknown" id="networkStatus"></span>
                ç½‘ç»œè¿æ¥
            </h3>
            <div id="networkInfo">ç­‰å¾…æ£€æŸ¥...</div>
            <button class="btn" onclick="checkNetwork()">æ£€æŸ¥ç½‘ç»œ</button>
        </div>

        <div class="diagnostic-section">
            <h3>
                <span class="status-indicator status-unknown" id="authStatus"></span>
                èº«ä»½éªŒè¯
            </h3>
            <div id="authInfo">ç­‰å¾…æ£€æŸ¥...</div>
            <button class="btn" onclick="checkAuth()">æ£€æŸ¥è®¤è¯</button>
        </div>

        <div class="diagnostic-section">
            <h3>
                <span class="status-indicator status-unknown" id="firestoreStatus"></span>
                Firestoreæ•°æ®åº“
            </h3>
            <div id="firestoreInfo">ç­‰å¾…æ£€æŸ¥...</div>
            <button class="btn" onclick="checkFirestore()">æ£€æŸ¥æ•°æ®åº“</button>
        </div>

        <div id="results"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, doc, getDoc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Firebaseé…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyDAtk4_1580AfAQYh0aGeykavDYfnflbKc",
            authDomain: "zhlscglxt.firebaseapp.com",
            projectId: "zhlscglxt",
            storageBucket: "zhlscglxt.firebasestorage.app",
            messagingSenderId: "36495989654",
            appId: "1:36495989654:web:3ad7266c9832ff25569185"
        };

        // å…¨å±€å˜é‡
        window.firebaseConfig = firebaseConfig;
        window.firebaseApp = null;
        window.firebaseDB = null;
        window.firebaseAuth = null;
        window.diagnosticResults = {};

        // åˆå§‹åŒ–Firebase
        try {
            window.firebaseApp = initializeApp(firebaseConfig);
            window.firebaseDB = getFirestore(window.firebaseApp);
            window.firebaseAuth = getAuth(window.firebaseApp);
            
            // å¯¼å‡ºå‡½æ•°åˆ°å…¨å±€
            window.collection = collection;
            window.doc = doc;
            window.getDoc = getDoc;
            window.setDoc = setDoc;
            window.serverTimestamp = serverTimestamp;
            window.signInAnonymously = signInAnonymously;
            
            console.log('Firebase SDK åŠ è½½æˆåŠŸ');
        } catch (error) {
            console.error('Firebase SDK åŠ è½½å¤±è´¥:', error);
        }
    </script>

    <script>
        function showResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            results.appendChild(div);
            div.scrollIntoView({ behavior: 'smooth' });
        }

        function updateStatus(elementId, status) {
            const element = document.getElementById(elementId);
            element.className = `status-indicator status-${status}`;
        }

        function updateProgress(percent) {
            document.getElementById('progressFill').style.width = percent + '%';
        }

        async function checkConfig() {
            showResult('ğŸ” æ£€æŸ¥Firebaseé…ç½®...', 'info');
            
            try {
                const config = window.firebaseConfig;
                const configText = JSON.stringify(config, null, 2);
                document.getElementById('configDisplay').textContent = configText;
                
                // éªŒè¯å¿…éœ€å­—æ®µ
                const requiredFields = ['apiKey', 'authDomain', 'projectId', 'storageBucket', 'messagingSenderId', 'appId'];
                const missingFields = requiredFields.filter(field => !config[field]);
                
                if (missingFields.length > 0) {
                    updateStatus('configStatus', 'error');
                    showResult(`âŒ é…ç½®ç¼ºå°‘å¿…éœ€å­—æ®µ: ${missingFields.join(', ')}`, 'error');
                    return false;
                } else {
                    updateStatus('configStatus', 'success');
                    showResult('âœ… Firebaseé…ç½®éªŒè¯æˆåŠŸ', 'success');
                    return true;
                }
            } catch (error) {
                updateStatus('configStatus', 'error');
                showResult(`âŒ é…ç½®æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                return false;
            }
        }

        async function checkNetwork() {
            showResult('ğŸŒ æ£€æŸ¥ç½‘ç»œè¿æ¥...', 'info');
            
            try {
                // æ£€æŸ¥åŸºæœ¬ç½‘ç»œè¿æ¥
                const response = await fetch('https://www.google.com/favicon.ico', { 
                    mode: 'no-cors',
                    cache: 'no-cache'
                });
                
                // æ£€æŸ¥FirebaseæœåŠ¡è¿æ¥
                const firebaseResponse = await fetch('https://firebase.googleapis.com/', {
                    mode: 'no-cors',
                    cache: 'no-cache'
                });
                
                updateStatus('networkStatus', 'success');
                showResult('âœ… ç½‘ç»œè¿æ¥æ­£å¸¸ï¼Œå¯ä»¥è®¿é—®FirebaseæœåŠ¡', 'success');
                
                document.getElementById('networkInfo').innerHTML = `
                    <div>âœ… åŸºæœ¬ç½‘ç»œè¿æ¥: æ­£å¸¸</div>
                    <div>âœ… FirebaseæœåŠ¡è¿æ¥: æ­£å¸¸</div>
                    <div>ğŸŒ åœ¨çº¿çŠ¶æ€: ${navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿'}</div>
                `;
                
                return true;
            } catch (error) {
                updateStatus('networkStatus', 'error');
                showResult(`âŒ ç½‘ç»œè¿æ¥æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                
                document.getElementById('networkInfo').innerHTML = `
                    <div>âŒ ç½‘ç»œè¿æ¥: å¤±è´¥</div>
                    <div>ğŸŒ åœ¨çº¿çŠ¶æ€: ${navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿'}</div>
                    <div>é”™è¯¯: ${error.message}</div>
                `;
                
                return false;
            }
        }

        async function checkAuth() {
            showResult('ğŸ” æ£€æŸ¥èº«ä»½éªŒè¯...', 'info');
            
            try {
                if (!window.firebaseAuth) {
                    throw new Error('Firebase Auth æœªåˆå§‹åŒ–');
                }
                
                // å°è¯•åŒ¿åç™»å½•
                await window.signInAnonymously(window.firebaseAuth);
                const user = window.firebaseAuth.currentUser;
                
                if (user) {
                    updateStatus('authStatus', 'success');
                    showResult(`âœ… åŒ¿åç™»å½•æˆåŠŸï¼Œç”¨æˆ·ID: ${user.uid}`, 'success');
                    
                    document.getElementById('authInfo').innerHTML = `
                        <div>âœ… è®¤è¯çŠ¶æ€: å·²ç™»å½•</div>
                        <div>ğŸ‘¤ ç”¨æˆ·ID: ${user.uid}</div>
                        <div>ğŸ” è®¤è¯æ–¹å¼: åŒ¿åç™»å½•</div>
                    `;
                    
                    return true;
                } else {
                    throw new Error('ç™»å½•æˆåŠŸä½†æœªè·å–åˆ°ç”¨æˆ·ä¿¡æ¯');
                }
            } catch (error) {
                updateStatus('authStatus', 'error');
                showResult(`âŒ èº«ä»½éªŒè¯å¤±è´¥: ${error.message}`, 'error');
                
                document.getElementById('authInfo').innerHTML = `
                    <div>âŒ è®¤è¯çŠ¶æ€: å¤±è´¥</div>
                    <div>é”™è¯¯: ${error.message}</div>
                `;
                
                return false;
            }
        }

        async function checkFirestore() {
            showResult('ğŸ—„ï¸ æ£€æŸ¥Firestoreæ•°æ®åº“...', 'info');
            
            try {
                if (!window.firebaseDB) {
                    throw new Error('Firestore æœªåˆå§‹åŒ–');
                }
                
                // å°è¯•è¯»å–æµ‹è¯•æ–‡æ¡£
                const testDocRef = window.doc(window.collection(window.firebaseDB, 'test'), 'connection');
                await window.getDoc(testDocRef);
                
                // å°è¯•å†™å…¥æµ‹è¯•æ–‡æ¡£
                await window.setDoc(testDocRef, {
                    test: true,
                    timestamp: window.serverTimestamp(),
                    userAgent: navigator.userAgent
                });
                
                updateStatus('firestoreStatus', 'success');
                showResult('âœ… Firestoreæ•°æ®åº“è¿æ¥æˆåŠŸï¼Œè¯»å†™æ“ä½œæ­£å¸¸', 'success');
                
                document.getElementById('firestoreInfo').innerHTML = `
                    <div>âœ… æ•°æ®åº“è¿æ¥: æ­£å¸¸</div>
                    <div>âœ… è¯»å–æƒé™: æ­£å¸¸</div>
                    <div>âœ… å†™å…¥æƒé™: æ­£å¸¸</div>
                    <div>ğŸ“Š é¡¹ç›®ID: ${window.firebaseConfig.projectId}</div>
                `;
                
                return true;
            } catch (error) {
                updateStatus('firestoreStatus', 'error');
                showResult(`âŒ Firestoreæ•°æ®åº“æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                
                document.getElementById('firestoreInfo').innerHTML = `
                    <div>âŒ æ•°æ®åº“è¿æ¥: å¤±è´¥</div>
                    <div>é”™è¯¯: ${error.message}</div>
                `;
                
                return false;
            }
        }

        async function runQuickTest() {
            showResult('ğŸš€ å¼€å§‹å¿«é€Ÿæµ‹è¯•...', 'info');
            updateProgress(0);
            
            const configOk = await checkConfig();
            updateProgress(50);
            
            if (configOk) {
                const authOk = await checkAuth();
                updateProgress(100);
                
                if (authOk) {
                    updateStatus('overallStatus', 'success');
                    showResult('ğŸ‰ å¿«é€Ÿæµ‹è¯•å®Œæˆï¼FirebaseåŸºæœ¬åŠŸèƒ½æ­£å¸¸', 'success');
                } else {
                    updateStatus('overallStatus', 'warning');
                    showResult('âš ï¸ å¿«é€Ÿæµ‹è¯•å®Œæˆï¼Œä½†èº«ä»½éªŒè¯æœ‰é—®é¢˜', 'warning');
                }
            } else {
                updateStatus('overallStatus', 'error');
                showResult('âŒ å¿«é€Ÿæµ‹è¯•å¤±è´¥ï¼Œé…ç½®æœ‰é—®é¢˜', 'error');
            }
        }

        async function runFullDiagnostic() {
            showResult('ğŸ” å¼€å§‹å®Œæ•´è¯Šæ–­...', 'info');
            updateProgress(0);
            
            const configOk = await checkConfig();
            updateProgress(25);
            
            const networkOk = await checkNetwork();
            updateProgress(50);
            
            const authOk = await checkAuth();
            updateProgress(75);
            
            const firestoreOk = await checkFirestore();
            updateProgress(100);
            
            // ç»¼åˆè¯„ä¼°
            const allOk = configOk && networkOk && authOk && firestoreOk;
            const partialOk = configOk && networkOk;
            
            if (allOk) {
                updateStatus('overallStatus', 'success');
                showResult('ğŸ‰ å®Œæ•´è¯Šæ–­å®Œæˆï¼æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼ŒFirebaseå¯ä»¥æ­£å¸¸ä½¿ç”¨', 'success');
            } else if (partialOk) {
                updateStatus('overallStatus', 'warning');
                showResult('âš ï¸ å®Œæ•´è¯Šæ–­å®Œæˆï¼ŒåŸºæœ¬åŠŸèƒ½æ­£å¸¸ä½†éƒ¨åˆ†åŠŸèƒ½æœ‰é—®é¢˜', 'warning');
            } else {
                updateStatus('overallStatus', 'error');
                showResult('âŒ å®Œæ•´è¯Šæ–­å®Œæˆï¼Œå‘ç°ä¸¥é‡é—®é¢˜éœ€è¦ä¿®å¤', 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œå¿«é€Ÿæµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(runQuickTest, 1000);
        });
    </script>
</body>
</html>
