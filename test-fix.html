<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            color: #1f2937;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        h1 {
            color: #059669;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-result {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .success {
            background: #ecfdf5;
            border: 2px solid #059669;
            color: #059669;
        }
        
        .error {
            background: #fef2f2;
            border: 2px solid #dc2626;
            color: #dc2626;
        }
        
        .info {
            background: #eff6ff;
            border: 2px solid #3b82f6;
            color: #3b82f6;
        }
        
        .big-button {
            background: #059669;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            width: 100%;
            box-sizing: border-box;
        }
        
        .big-button:hover {
            background: #047857;
        }
        
        .big-button.danger {
            background: #dc2626;
        }
        
        .big-button.danger:hover {
            background: #b91c1c;
        }
        
        .data-info {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ æ•°æ®ä¿®å¤æµ‹è¯•</h1>
        
        <div id="testResults"></div>
        
        <button class="big-button" onclick="runTests()">
            ğŸ§ª è¿è¡Œæ•°æ®æ£€æµ‹
        </button>
        
        <button class="big-button" onclick="fixData()" id="fixBtn" style="display: none;">
            ğŸš€ ä¿®å¤æ•°æ®é—®é¢˜
        </button>
        
        <button class="big-button" onclick="openMainPage()">
            ğŸ“Š æ‰“å¼€ä¸»é¡µé¢
        </button>
        
        <button class="big-button danger" onclick="clearAllData()">
            ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼ˆå±é™©æ“ä½œï¼‰
        </button>
    </div>

    <script>
        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const result = document.createElement('div');
            result.className = 'test-result ' + type;
            result.innerHTML = message;
            resultsDiv.appendChild(result);
        }
        
        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }
        
        function runTests() {
            clearResults();
            addResult('ğŸ” å¼€å§‹æ£€æµ‹æ•°æ®çŠ¶æ€...', 'info');
            
            // æ£€æŸ¥localStorageæ•°æ®
            const productionData = localStorage.getItem('productionData');
            const operationLogs = localStorage.getItem('operationLogs');
            const materialPurchases = localStorage.getItem('materialPurchases');
            
            if (productionData) {
                try {
                    const data = JSON.parse(productionData);
                    addResult(`âœ… æ‰¾åˆ°ç”Ÿäº§æ•°æ®ï¼š${data.length} æ¡è®°å½•`, 'success');
                    
                    // æ˜¾ç¤ºæ•°æ®è¯¦æƒ…
                    const dataInfo = document.createElement('div');
                    dataInfo.className = 'data-info';
                    dataInfo.innerHTML = `
                        <strong>æ•°æ®è¯¦æƒ…ï¼š</strong><br>
                        - æ€»è®°å½•æ•°ï¼š${data.length}<br>
                        - ç¬¬ä¸€æ¡è®°å½•ï¼š${JSON.stringify(data[0], null, 2)}<br>
                        - æœ€åä¸€æ¡è®°å½•ï¼š${JSON.stringify(data[data.length - 1], null, 2)}
                    `;
                    document.getElementById('testResults').appendChild(dataInfo);
                    
                } catch (error) {
                    addResult(`âŒ ç”Ÿäº§æ•°æ®æ ¼å¼é”™è¯¯ï¼š${error.message}`, 'error');
                }
            } else {
                addResult('âŒ æ²¡æœ‰æ‰¾åˆ°ç”Ÿäº§æ•°æ®', 'error');
            }
            
            if (operationLogs) {
                try {
                    const logs = JSON.parse(operationLogs);
                    addResult(`âœ… æ‰¾åˆ°æ“ä½œæ—¥å¿—ï¼š${logs.length} æ¡`, 'success');
                } catch (error) {
                    addResult(`âŒ æ“ä½œæ—¥å¿—æ ¼å¼é”™è¯¯ï¼š${error.message}`, 'error');
                }
            } else {
                addResult('âš ï¸ æ²¡æœ‰æ‰¾åˆ°æ“ä½œæ—¥å¿—', 'info');
            }
            
            if (materialPurchases) {
                try {
                    const materials = JSON.parse(materialPurchases);
                    addResult(`âœ… æ‰¾åˆ°åŸææ–™è®°å½•ï¼š${materials.length} æ¡`, 'success');
                } catch (error) {
                    addResult(`âŒ åŸææ–™è®°å½•æ ¼å¼é”™è¯¯ï¼š${error.message}`, 'error');
                }
            } else {
                addResult('âš ï¸ æ²¡æœ‰æ‰¾åˆ°åŸææ–™è®°å½•', 'info');
            }
            
            // æ£€æŸ¥DataManagerç±»æ˜¯å¦å­˜åœ¨
            if (typeof DataManager !== 'undefined') {
                addResult('âœ… DataManagerç±»å·²åŠ è½½', 'success');
            } else {
                addResult('âŒ DataManagerç±»æœªåŠ è½½', 'error');
            }
            
            // æ£€æŸ¥window.dataManagerå®ä¾‹
            if (window.dataManager) {
                addResult('âœ… window.dataManagerå®ä¾‹å­˜åœ¨', 'success');
                addResult(`ğŸ“Š å®ä¾‹æ•°æ®æ¡æ•°ï¼š${window.dataManager.data ? window.dataManager.data.length : 'æœªçŸ¥'}`, 'info');
            } else {
                addResult('âŒ window.dataManagerå®ä¾‹ä¸å­˜åœ¨', 'error');
                document.getElementById('fixBtn').style.display = 'block';
            }
        }
        
        function fixData() {
            addResult('ğŸ”§ å¼€å§‹ä¿®å¤æ•°æ®...', 'info');
            
            try {
                // å°è¯•åˆ›å»ºDataManagerå®ä¾‹
                if (typeof DataManager !== 'undefined') {
                    window.dataManager = new DataManager();
                    addResult('âœ… DataManagerå®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                    
                    // æ£€æŸ¥æ•°æ®åŠ è½½
                    if (window.dataManager.data && window.dataManager.data.length > 0) {
                        addResult(`âœ… æ•°æ®åŠ è½½æˆåŠŸï¼š${window.dataManager.data.length} æ¡è®°å½•`, 'success');
                    } else {
                        addResult('âš ï¸ æ•°æ®ä¸ºç©ºï¼Œå°è¯•é‡æ–°åŠ è½½...', 'info');
                        window.dataManager.loadFromLocalStorage();
                        
                        if (window.dataManager.data && window.dataManager.data.length > 0) {
                            addResult(`âœ… é‡æ–°åŠ è½½æˆåŠŸï¼š${window.dataManager.data.length} æ¡è®°å½•`, 'success');
                        } else {
                            addResult('âŒ é‡æ–°åŠ è½½å¤±è´¥', 'error');
                        }
                    }
                    
                    document.getElementById('fixBtn').style.display = 'none';
                } else {
                    addResult('âŒ DataManagerç±»ä¸å­˜åœ¨ï¼Œæ— æ³•ä¿®å¤', 'error');
                }
            } catch (error) {
                addResult(`âŒ ä¿®å¤å¤±è´¥ï¼š${error.message}`, 'error');
            }
        }
        
        function openMainPage() {
            window.open('index.html', '_blank');
        }
        
        function clearAllData() {
            if (confirm('âš ï¸ è­¦å‘Šï¼šè¿™å°†åˆ é™¤æ‰€æœ‰æ•°æ®ï¼\n\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                localStorage.removeItem('productionData');
                localStorage.removeItem('operationLogs');
                localStorage.removeItem('materialPurchases');
                localStorage.removeItem('customAreas');
                
                addResult('ğŸ—‘ï¸ æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'error');
                
                setTimeout(() => {
                    location.reload();
                }, 2000);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            setTimeout(runTests, 500);
        };
    </script>
</body>
</html>
